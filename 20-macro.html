
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <link rel="canonical" href="https://nus-cs1010.github.io/2021-s1/20-macro.html">
      
      
      <link rel="shortcut icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.0.2">
    
    
      
        <title>20. C Preprocessing - CS1010 Programming Methodology</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.38780c08.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.3f72e892.min.css">
        
          
          
          <meta name="theme-color" content="#009485">
        
      
    
    
    
      
        
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="stylesheets/extra.css">
    
      <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:400,700">
    
      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&display=swap">
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="teal" data-md-color-accent="">
      
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#unit-20-c-preprocessor-constants-and-macros" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="https://nus-cs1010.github.io/2021-s1" title="CS1010 Programming Methodology" class="md-header-nav__button md-logo" aria-label="CS1010 Programming Methodology">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            CS1010 Programming Methodology
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              20. C Preprocessing
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://nus-cs1010.github.io/2021-s1" title="CS1010 Programming Methodology" class="md-nav__button md-logo" aria-label="CS1010 Programming Methodology">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    CS1010 Programming Methodology
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="index.html" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="midterm.html" class="md-nav__link">
      Midterm
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="pe1.html" class="md-nav__link">
      PE1
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="pe2.html" class="md-nav__link">
      PE2
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      General
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="General" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        <span class="md-nav__icon md-icon"></span>
        General
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="about.html" class="md-nav__link">
      About CS1010
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="outcomes.html" class="md-nav__link">
      Learning Outcomes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="schedule.html" class="md-nav__link">
      Schedule
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="accounts.html" class="md-nav__link">
      Accounts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="policies.html" class="md-nav__link">
      Policies
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6" checked>
    
    <label class="md-nav__link" for="nav-6">
      Notes
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Notes" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        <span class="md-nav__icon md-icon"></span>
        Notes
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="01-program.html" class="md-nav__link">
      1. What is a Program?
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="02-algo.html" class="md-nav__link">
      2. Computational Problem & Algorithms
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="03-func.html" class="md-nav__link">
      3. Functions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="04-type.html" class="md-nav__link">
      4. Types
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="05-first-c.html" class="md-nav__link">
      5. First C Program
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="06-cs1010-io.html" class="md-nav__link">
      6. CS1010 I/O Library
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="07-arithmetic-ops.html" class="md-nav__link">
      7. Arithmetic Operations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="08-if-else.html" class="md-nav__link">
      8. Conditionals
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="09-logical-exp.html" class="md-nav__link">
      9. Logical Expressions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="10-assert.html" class="md-nav__link">
      10. Assertion
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="11-loop.html" class="md-nav__link">
      11. Loops
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="12-invariant.html" class="md-nav__link">
      12. Loop Invariant
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="13-call-stack.html" class="md-nav__link">
      13. Call Stack
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="14-pointers.html" class="md-nav__link">
      14. Memory Addresses
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="15-array.html" class="md-nav__link">
      15. Array
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="16-string.html" class="md-nav__link">
      16. String
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="17-call-by-reference.html" class="md-nav__link">
      17. Call by Reference
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="18-heap.html" class="md-nav__link">
      18. Heap
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="19-md-array.html" class="md-nav__link">
      19. Multi-dimensional Arrays
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        20. C Preprocessing
        <span class="md-nav__icon md-icon"></span>
      </label>
    
    <a href="20-macro.html" class="md-nav__link md-nav__link--active">
      20. C Preprocessing
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#learning-objectives" class="md-nav__link">
    Learning Objectives
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#revisiting-c-compilation-process" class="md-nav__link">
    Revisiting C Compilation Process
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preprocessing" class="md-nav__link">
    Preprocessing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#include" class="md-nav__link">
    #include
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#define-constant" class="md-nav__link">
    #define Constant
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-include-directive" class="md-nav__link">
    The #include Directive
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#define-macro" class="md-nav__link">
    #define Macro
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pitfalls-and-best-practices" class="md-nav__link">
    Pitfalls and Best Practices
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#problem-set-20" class="md-nav__link">
    Problem Set 20
  </a>
  
    <nav class="md-nav" aria-label="Problem Set 20">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#problem-201" class="md-nav__link">
    Problem 20.1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#problem-202" class="md-nav__link">
    Problem 20.2
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#appendix-a" class="md-nav__link">
    Appendix A
  </a>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="21-assert.html" class="md-nav__link">
      21. The assert macro
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="22-efficiency.html" class="md-nav__link">
      22. Efficiency
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="23-search.html" class="md-nav__link">
      23. Searching
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="24-sort.html" class="md-nav__link">
      24. Sorting
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="25-tower.html" class="md-nav__link">
      25. Tower of Hanoi
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="26-permutation.html" class="md-nav__link">
      26. Permutation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="27-queens.html" class="md-nav__link">
      27. N Queens
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="28-struct.html" class="md-nav__link">
      28. Struct
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="29-stdio.html" class="md-nav__link">
      29. Standard I/O
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Exercises
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Exercises" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        <span class="md-nav__icon md-icon"></span>
        Exercises
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="ex00.html" class="md-nav__link">
      0. Echo, Divide, Quadratic
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="ex01.html" class="md-nav__link">
      1. GCD, Day, Leap
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="ex02.html" class="md-nav__link">
      2. Binary, Rectangle, Fibonacci
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="ex03.html" class="md-nav__link">
      3. Weekday, Circle, Histogram
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="ex04.html" class="md-nav__link">
      4. Fill, Sudoku
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      Assignments
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Assignments" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        <span class="md-nav__icon md-icon"></span>
        Assignments
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="assignment.html" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="as01.html" class="md-nav__link">
      1. Box, Digits, Suffix, Taxi
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="as02.html" class="md-nav__link">
      2. Collatz, Triangle, Prime, Pattern
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="as03.html" class="md-nav__link">
      3. ID, Kendall, Max, CountingSort
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="as04.html" class="md-nav__link">
      4. SelectionSort, Mastermind
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="as05.html" class="md-nav__link">
      5. Contact, Social, Life
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="as06.html" class="md-nav__link">
      6. Add, Frequency, Permutation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="as07.html" class="md-nav__link">
      7. Peak, Sort, Inversion
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="as08.html" class="md-nav__link">
      8. Walk, Maze
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="readings.html" class="md-nav__link">
      Readings
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="c-in-cs1010.html" class="md-nav__link">
      C in CS1010
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="library.html" class="md-nav__link">
      CS1010 I/O Library
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="style.html" class="md-nav__link">
      C Style Convention
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="documentation.html" class="md-nav__link">
      C Documentation Guide
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="messages.html" class="md-nav__link">
      Compiler Messages
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-15" type="checkbox" id="nav-15">
    
    <label class="md-nav__link" for="nav-15">
      Software/Tools
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Software/Tools" data-md-level="1">
      <label class="md-nav__title" for="nav-15">
        <span class="md-nav__icon md-icon"></span>
        Software/Tools
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="environments.html" class="md-nav__link">
      Programming Environments
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="unix.html" class="md-nav__link">
      UNIX
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="clang.html" class="md-nav__link">
      CLang
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="vim.html" class="md-nav__link">
      Vim
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="tmate.html" class="md-nav__link">
      TMate
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="zoom.html" class="md-nav__link">
      Zoom
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="archive.html" class="md-nav__link">
      Older Announcements
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="1819s1.html" class="md-nav__link">
      18/19 Sem 1
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#learning-objectives" class="md-nav__link">
    Learning Objectives
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#revisiting-c-compilation-process" class="md-nav__link">
    Revisiting C Compilation Process
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preprocessing" class="md-nav__link">
    Preprocessing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#include" class="md-nav__link">
    #include
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#define-constant" class="md-nav__link">
    #define Constant
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-include-directive" class="md-nav__link">
    The #include Directive
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#define-macro" class="md-nav__link">
    #define Macro
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pitfalls-and-best-practices" class="md-nav__link">
    Pitfalls and Best Practices
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#problem-set-20" class="md-nav__link">
    Problem Set 20
  </a>
  
    <nav class="md-nav" aria-label="Problem Set 20">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#problem-201" class="md-nav__link">
    Problem 20.1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#problem-202" class="md-nav__link">
    Problem 20.2
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#appendix-a" class="md-nav__link">
    Appendix A
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="unit-20-c-preprocessor-constants-and-macros">Unit 20: C Preprocessor: Constants and Macros</h1>
<h2 id="learning-objectives">Learning Objectives</h2>
<p>After this unit, students should:</p>
<ul>
<li>understand how the preprocessing step in the compilation pipeline works</li>
<li>understand how #include statements work</li>
<li>understand why we should avoid hard-coding magic constants and start having the habit of using
  <code>#define</code> to define constants in their code.</li>
<li>understand how <code>#define</code> can be used to define macros</li>
<li>be able to explain the differences between macros and functions</li>
<li>be able to write macros in a way that avoid the common pitfalls</li>
</ul>
<h2 id="revisiting-c-compilation-process">Revisiting C Compilation Process</h2>
<p>In this unit, we are going to delve deeper into the C compilation process, focusing on a step called <em>pre-processing</em>.  This step is usually the first step in the compilation process.  In the first lecture, we lumped this process under <code>compile (etc)</code> in the figure below.</p>
<p><img alt="compile" src="figures/c-compile-run/c-compile-run.001.png" /></p>
<p>We can now separate one of the steps under "etc" as the pre-processing step,</p>
<p><img alt="compile" src="figures/c-compile-run/c-compile-run.002.png" /></p>
<h2 id="preprocessing">Preprocessing</h2>
<p>Preprocessing is, in essence, a text processing and substitution process, and so it is not specific to C.  In C, this process is used to implement, among other things: (i) file inclusion, (ii) macro, and (iii) conditional compilation.</p>
<p>A C pre-processor processes all the lines in the input file that starts with a <code>#</code> character.  Any line that starts with <code>#</code> is a <em>preprocessor directive</em>.  You have seen two of such directives, <code>#include</code> to include a file, and <code>#define</code> to define a constant.</p>
<h2 id="include"><code>#include</code></h2>
<p>The <code>#include</code> directive has the format</p>
<p><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="cp">#include</span> <span class="cpf">&lt;filename&gt;</span><span class="cp"></span>
</code></pre></div>
</td></tr></table>
or</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="cp">#include</span> <span class="cpf">&quot;filename&quot;</span><span class="cp"></span>
</code></pre></div>
</td></tr></table>
<p>When the C pre-processor sees this directive, it reads the file specified by the given filename, and inserts the text, line-by-line, from this file, into the current file, in the location where the line <code>#include</code> occurs.   Any C preprocessor directive in the included file is recursively processed.</p>
<h2 id="define-constant">#define Constant</h2>
<p>We have seen how we can use <code>#define</code> to define constant values in our code in our exercises and assignments.  For instance, in Exercise 2, <code>rectangle.c</code>, you have seen:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>#define TOP_LEFT &quot;╔&quot;
#define TOP_RIGHT &quot;╗&quot;
#define BOTTOM_RIGHT &quot;╝&quot;
#define BOTTOM_LEFT &quot;╚&quot;
#define HORIZONTAL &quot;═&quot;
#define VERTICAL &quot;║&quot;
</code></pre></div>
</td></tr></table>
<p>What is the advantage of using <code>TOP_LEFT</code> (which is 8 characters) instead of just one character <code>╔</code>?</p>
<p>It is a good programming practice to avoid hardcoding constant values (also called <em>magic constants</em>) in our code so that our code can be easily changed when the requirement of our program has changed.  Defining these constants as <code>#define</code> allows us to easily modify our program.   For instance, suppose that we wish to change the way we draw the rectangle.  Instead of</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="err">╔════════╗</span>
<span class="err">║</span>        <span class="err">║</span>
<span class="err">║</span>        <span class="err">║</span>
<span class="err">║</span>        <span class="err">║</span>
<span class="err">║</span>        <span class="err">║</span>
<span class="err">╚════════╝</span>
</code></pre></div>
</td></tr></table>
<p>We wish to draw it like this:
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="o">+--------+</span>
<span class="o">|</span>        <span class="o">|</span>
<span class="o">|</span>        <span class="o">|</span>
<span class="o">|</span>        <span class="o">|</span>
<span class="o">|</span>        <span class="o">|</span>
<span class="o">+--------+</span>
</code></pre></div>
</td></tr></table></p>
<p>All we have to do, is to change the defined constants:
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>#define TOP_LEFT &quot;+&quot;
#define TOP_RIGHT &quot;+&quot;
#define BOTTOM_RIGHT &quot;+&quot;
#define BOTTOM_LEFT &quot;+&quot;
#define HORIZONTAL &quot;-&quot;
#define VERTICAL &quot;|&quot;
</code></pre></div>
</td></tr></table></p>
<p>We do not have to make any change to the code to draw the rectangles!  This reduces the chances that you introduce bugs into the code.  See the Appendix for the code.</p>
<p>Let's consider the second example, <code>taxi.c</code> from Assignment 1:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kt">double</span> <span class="nf">metered_fare</span><span class="p">(</span><span class="kt">long</span> <span class="n">distance</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">double</span> <span class="n">fare</span> <span class="o">=</span> <span class="mf">3.20</span><span class="p">;</span>

    <span class="c1">// The first 1 km or less</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">distance</span> <span class="o">&lt;=</span> <span class="mi">1000</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">fare</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">distance</span> <span class="o">-=</span> <span class="mi">1000</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">distance</span> <span class="o">&lt;=</span> <span class="mi">9000</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">fare</span> <span class="o">+=</span> <span class="mf">0.22</span> <span class="o">*</span> <span class="n">lceil</span><span class="p">(</span><span class="n">distance</span><span class="p">,</span>  <span class="mi">400</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">fare</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// more than 10km</span>
    <span class="c1">// 0.22 * ceil(9000 / 400) = 0.22*23 = 5.06</span>
    <span class="n">fare</span> <span class="o">+=</span> <span class="mf">5.06</span><span class="p">;</span>

    <span class="n">distance</span> <span class="o">-=</span> <span class="mi">9000</span><span class="p">;</span>
    <span class="n">fare</span> <span class="o">+=</span> <span class="mf">0.22</span> <span class="o">*</span> <span class="n">lceil</span><span class="p">(</span><span class="n">distance</span><span class="p">,</span>  <span class="mi">350</span><span class="p">);</span>

    <span class="k">return</span> <span class="n">fare</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>
<p>In the snippet above, there are many hard coded values.  Suppose one day, the taxi fare changes (and that day will come).  Perhaps the base fare is more, perhaps the distance threshold is shorter.  We will have to change the code above to calculate the new fare.  By littering the code above with hardcoded values, the code is difficult and error-prone to change.  </p>
<p>You might think that we can just search and replace to update the code when the fare changes.  But this is error-prone as well!  Suppose that the taxi fare increases to $0.25 per 350m after 10km, but remains $0.22 between 1 - 10km, then we cannot just replace every occurrence of <code>0.22</code> with <code>0.25</code>.</p>
<p>We can make our code "future-ready" by abstracting out all the magic numbers and define constants for each of them.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="cp">#define BASE_FARE 3.20</span>
<span class="cp">#define BASE_DISTANCE 1000</span>
<span class="cp">#define TIER_ONE_FARE 0.22</span>
<span class="cp">#define TIER_ONE_DISTANCE 400</span>
<span class="cp">#define TIER_ONE_LIMIT 10000</span>
<span class="cp">#define TIER_TWO_FARE 0.22</span>
<span class="cp">#define TIER_TWO_DISTANCE 350</span>

<span class="kt">double</span> <span class="nf">metered_fare</span><span class="p">(</span><span class="kt">long</span> <span class="n">distance</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">double</span> <span class="n">fare</span> <span class="o">=</span> <span class="n">BASE_FARE</span><span class="p">;</span>

  <span class="n">distance</span> <span class="o">-=</span> <span class="n">BASE_DISTANCE</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">distance</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">fare</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">distance</span> <span class="o">&lt;=</span> <span class="n">TIER_ONE_LIMIT</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">fare</span> <span class="o">+=</span> <span class="n">TIER_ONE_FARE</span> <span class="o">*</span> <span class="n">lceil</span><span class="p">(</span><span class="n">distance</span><span class="p">,</span>  <span class="n">TIER_ONE_DISTANCE</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="n">fare</span> <span class="o">+=</span> <span class="n">TIER_ONE_FARE</span> <span class="o">*</span> <span class="p">(</span><span class="n">TIER_ONE_LIMIT</span> <span class="o">/</span> <span class="n">TIER_ONE_DISTANCE</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="n">distance</span> <span class="o">-=</span> <span class="n">TIER_ONE_LIMIT</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">distance</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">fare</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">fare</span> <span class="o">+=</span> <span class="n">TIER_TWO_FARE</span> <span class="o">*</span> <span class="n">lceil</span><span class="p">(</span><span class="n">distance</span><span class="p">,</span> <span class="n">TIER_TWO_DISTANCE</span><span class="p">);</span>

  <span class="k">return</span> <span class="n">fare</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>
<p>Replacing the magic numbers with constants make the code a bit harder to read, but now, it is super easy to change.  Suppose, one day, the base taxi fare is increased to $3.40, and then $0.20 per 500m subsequently up to 10km, and $0.15 per 600m thereafter, we only need to change:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="cp">#define BASE_FARE 3.40</span>
<span class="cp">#define BASE_DISTANCE 1000</span>
<span class="cp">#define TIER_ONE_FARE 0.20</span>
<span class="cp">#define TIER_ONE_DISTANCE 500</span>
<span class="cp">#define TIER_ONE_LIMIT 10000</span>
<span class="cp">#define TIER_TWO_FARE 0.15</span>
<span class="cp">#define TIER_TWO_DISTANCE 600</span>
</code></pre></div>
</td></tr></table>
<p>The logic of the code remains the same.   </p>
<p>How does the C pre-processor process the <code>#define</code> directive?  When we write a <code>#define</code> directive, the directive should be followed by an <em>identifier</em> and a <em>token</em>.  The token may contain space but <em>must be terminated by a newline</em>.  In the example above, <code>BASE_FARE</code> is the identifier, and <code>3.40</code> is the token.</p>
<p>When the C pre-processor sees the <code>#define</code> directive, it replaces all instances of the identifier in the file with the token.  This is merely a text substitution operation.</p>
<h2 id="the-include-directive">The #include Directive</h2>
<p>Another commonly used directive is <code>#include</code>.  You have seen how we used this to "import" the <code>cs1010.h</code>, <code>stdbool.h</code>, <code>math.h</code>, etc.  When we introduced this at the beginning of the lecture, we compared this to the <code>import</code> <code>require</code>, <code>use</code> commands seen in other programming languages.  But the mechanism for <code>#include</code> is very different from the others.</p>
<p>The <code>#include</code> directive merely performs text substitution -- it recursively read the lines from the included file, and insert it into the location where the <code>#include</code> directive is.</p>
<p>Consider the example below.  Suppose we have three files:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="cm">/**</span>
<span class="cm"> * @file: a.c</span>
<span class="cm"> */</span>

<span class="cp">#include</span> <span class="cpf">&quot;b.h&quot;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">foo</span><span class="p">(</span><span class="n">PI</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="cm">/**</span>
<span class="cm"> * @file: b.h</span>
<span class="cm"> */</span>

<span class="cp">#include</span> <span class="cpf">&quot;c.h&quot;</span><span class="cp"></span>
<span class="cp">#define PI 3.1415926</span>
</code></pre></div>
</td></tr></table>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="cm">/**</span>
<span class="cm"> * @file: c.h</span>
<span class="cm"> */</span>

<span class="kt">void</span> <span class="nf">foo</span><span class="p">(</span><span class="kt">double</span> <span class="n">x</span><span class="p">);</span>
</code></pre></div>
</td></tr></table>
<p>Let's see what happens when we run C pre-processor on the file <code>a.c</code>.  We can ask <code>clang</code> to stop the compilation process after the pre-processing phase, using the flag <code>-E</code><sup id="fnref:1"><a class="footnote-ref" href="#fn:1">1</a></sup>.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>clang -E a.c
</code></pre></div>
</td></tr></table>
<p>The command will produce the output after C pre-processing:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="cp"># 1 &quot;a.c&quot;</span>
<span class="cp"># 1 &quot;&lt;built-in&gt;&quot; 1</span>
<span class="cp"># 1 &quot;&lt;built-in&gt;&quot; 3</span>
<span class="cp"># 360 &quot;&lt;built-in&gt;&quot; 3</span>
<span class="cp"># 1 &quot;&lt;command line&gt;&quot; 1</span>
<span class="cp"># 1 &quot;&lt;built-in&gt;&quot; 2</span>
<span class="cp"># 1 &quot;a.c&quot; 2</span>
<span class="cp"># 1 &quot;./b.h&quot; 1</span>
<span class="cp"># 1 &quot;./c.h&quot; 1</span>
<span class="kt">void</span> <span class="nf">foo</span><span class="p">(</span><span class="kt">double</span> <span class="n">x</span><span class="p">);</span>
<span class="cp"># 6 &quot;./b.h&quot; 2</span>
<span class="cp"># 5 &quot;a.c&quot; 2</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">foo</span><span class="p">(</span><span class="mf">3.1415926</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>
<p>The lines start with <code>#</code> are metadata meant for the compiler.  If we ignore those, we can see that the file <code>a.c</code> has been expanded into
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kt">void</span> <span class="nf">foo</span><span class="p">(</span><span class="kt">double</span> <span class="n">x</span><span class="p">);</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">foo</span><span class="p">(</span><span class="mf">3.1415926</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table></p>
<p>Line 1 above is included from file <code>c.h</code>, which in turn is included from file <code>b.h</code>.  The C pre-processor also substitutes the text <code>PI</code> with the text <code>3.1415926</code>, as the identifier <code>PI</code> is defined in <code>b.h</code>.</p>
<p>In C, we usually use <code>#include</code> to share common function declarations and constants.</p>
<h2 id="define-macro"><code>#define</code> Macro</h2>
<p>The <code>#define</code> directive can be used for a more flexible and powerful text substitution feature called <em>macro</em>.  <em>A macro is a block of code that is given an identifying name and is substituted and expanded during pre-processing.</em></p>
<p>For instance, we can write the following:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>#define SQUARE(x) x*x
</code></pre></div>
</td></tr></table>
<p>This macro is named <code>SQUARE</code>, just like a function we defined in Lecture 3 and it takes in a parameter <code>x</code> as well.  But that's where the similarity ends.  There are a few important differences between macros and functions in C:</p>
<ul>
<li>Macros are not called.  They are only substituted during the preprocessing phase which performs text processing on the source code.</li>
<li>Macros have no information about types. It has no return type and the parameters have no type.</li>
</ul>
<p>Take the example below.  The file:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="cp">#define SQUARE(x) x*x</span>
<span class="cp">#define PI 3.1415926</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">double</span> <span class="n">radius</span> <span class="o">=</span> <span class="mf">4.0</span><span class="p">;</span>
  <span class="n">cs1010_print_double</span><span class="p">(</span><span class="n">PI</span><span class="o">*</span><span class="n">SQUARE</span><span class="p">(</span><span class="n">radius</span><span class="p">));</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>
<p>Get expanded into:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">double</span> <span class="n">radius</span> <span class="o">=</span> <span class="mf">4.0</span><span class="p">;</span>
  <span class="n">cs1010_print_double</span><span class="p">(</span><span class="mf">3.1415926</span><span class="o">*</span><span class="n">radius</span><span class="o">*</span><span class="n">radius</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>
<p>Let's look at another example.  We have seen how to write a function that swaps two of the value of variables.  The one we wrote swaps two <code>double</code>.  If we want to swap two <code>long</code>, or two <code>char *</code>, etc, we will need to write a new function for each one.  </p>
<p>Let's write a generic macro that does swapping for any type.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="cp">#define SWAP(T, x, y) {\</span>
<span class="cp">  T temp;\</span>
<span class="cp">  temp = x;\</span>
<span class="cp">  x = y;\</span>
<span class="cp">  y = temp;\</span>
<span class="cp">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">long</span> <span class="n">x</span> <span class="o">=</span> <span class="mf">3.0</span><span class="p">;</span>
  <span class="kt">long</span> <span class="n">y</span> <span class="o">=</span> <span class="mf">-1.0</span><span class="p">;</span>
  <span class="n">SWAP</span><span class="p">(</span><span class="kt">long</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>
<p>The macro <code>SWAP</code> takes in three parameters, the first is the type T, the second and the third are the variables to be swapped.  This macro definition spans multiple lines.  Since C preprocessor ends the definition of a macro with the end of the line, we add a backslash character to "escape" the newline, telling the preprocessor not to treat the newline as the end of the macro definition.</p>
<p>The code above gets expanded to:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">long</span> <span class="n">x</span> <span class="o">=</span> <span class="mf">3.0</span><span class="p">;</span>
  <span class="kt">long</span> <span class="n">y</span> <span class="o">=</span> <span class="mf">-1.0</span><span class="p">;</span>
  <span class="p">{</span> <span class="kt">long</span> <span class="n">temp</span><span class="p">;</span> <span class="n">temp</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span> <span class="n">x</span> <span class="o">=</span> <span class="n">y</span><span class="p">;</span> <span class="n">y</span> <span class="o">=</span> <span class="n">temp</span><span class="p">;};</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>
<p>You might be bothered by the appearance of <code>{</code> and <code>}</code> on Line 5.  But note that this is perfectly valid syntax.  Recall that we said <code>{</code> and <code>}</code> defines a block, while we commonly define a block in the context of a function body, <code>if</code>, <code>else</code>, <code>for</code>, etc.  We can define a block anywhere in C.  The reason why it is necessary to place the substituted text within a block is left as an exercise (Problem 20.2).</p>
<h2 id="pitfalls-and-best-practices">Pitfalls and Best Practices</h2>
<p>It is easy to forget that macro is doing simple text substitution without an understanding of C syntax.  When we write macros, we should always guard against improper usage of macros.  Let's consider this:</p>
<p><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="cp">#define SQUARE(x) x*x</span>
</code></pre></div>
</td></tr></table>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="n">SQUARE</span><span class="p">(</span><span class="n">radius</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
</code></pre></div>
</td></tr></table></p>
<p>When the pre-processor substitutes the macro <code>SQUARE</code>, it replaces all instances of the text <code>x</code> with the text <code>radius + 2</code>.  After substitution, we get <code>radius + 2*radius + 2</code>!  This is not what we expected.</p>
<p>To prevent such unexpected expansion, we should always add parenthesis to our macro expression:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="cp">#define SQUARE(x) ((x)*(x))</span>
</code></pre></div>
</td></tr></table>
<p>So now,
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>SQUARE(radius + 2)
</code></pre></div>
</td></tr></table></p>
<p>gets expanded into <code>((radius + 2)*(radius + 2))</code>, which is what we would expect when we call <code>SQUARE</code>.</p>
<p>To help the readers of your code know that you are referencing a macro rather than a function, all macros should be written with uppercase letters.</p>
<h2 id="problem-set-20">Problem Set 20</h2>
<h3 id="problem-201">Problem 20.1</h3>
<p>a) Consider the macro below:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="cp">#define MIN(a,b)  a &lt; b ? a : b</span>

<span class="kt">long</span> <span class="n">i</span> <span class="o">=</span> <span class="n">MIN</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">);</span>
<span class="kt">long</span> <span class="n">j</span> <span class="o">=</span> <span class="n">MIN</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
</code></pre></div>
</td></tr></table>
<p>What are the values for <code>i</code> and <code>j</code> after executing the above?  </p>
<p>b)</p>
<p>CS1010-trained students should know better than to use the <code>++</code> operator, which combines two steps into one and has the side effects on value <code>i</code>.  Let's say someone who is not trained this way wrote the following code:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="cp">#define MIN(a,b)  a &lt; b ? a : b</span>

<span class="kt">long</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
<span class="kt">long</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span>
<span class="kt">long</span> <span class="n">k</span> <span class="o">=</span> <span class="n">MIN</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="o">++</span><span class="p">);</span>
</code></pre></div>
</td></tr></table>
<p>What are the values of <code>i</code> and <code>k</code> after executing the above?  Explain what happen.</p>
<h3 id="problem-202">Problem 20.2</h3>
<p>Suppose we write our <code>SWAP</code> macro without the opening and closing brackets:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="cp">#define SWAP(T, x, y) T temp = x;\</span>
<span class="cp">  x = y;\</span>
<span class="cp">  y = temp;</span>
</code></pre></div>
</td></tr></table>
<p>CS1010-trained students should know better than to write <code>if</code>-<code>else</code> block without <code>{</code> and <code>}</code>.  Suppose someone writes an <code>if-else</code> block without <code>{</code> and <code>}</code>.  What could go wrong if they use the macro above, also without the opening and closing brackets?</p>
<h2 id="appendix-a">Appendix A</h2>
<p>The three functions to solve Rectangle in Exercise 2.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kt">void</span> <span class="nf">draw_top_line</span><span class="p">(</span><span class="kt">long</span> <span class="n">width</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">cs1010_print_string</span><span class="p">(</span><span class="n">TOP_LEFT</span><span class="p">);</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">width</span> <span class="o">-</span> <span class="mi">2</span><span class="p">;</span> <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cs1010_print_string</span><span class="p">(</span><span class="n">HORIZONTAL</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="n">cs1010_println_string</span><span class="p">(</span><span class="n">TOP_RIGHT</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">draw_bottom_line</span><span class="p">(</span><span class="kt">long</span> <span class="n">width</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">cs1010_print_string</span><span class="p">(</span><span class="n">BOTTOM_LEFT</span><span class="p">);</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">width</span> <span class="o">-</span> <span class="mi">2</span><span class="p">;</span> <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cs1010_print_string</span><span class="p">(</span><span class="n">HORIZONTAL</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="n">cs1010_println_string</span><span class="p">(</span><span class="n">BOTTOM_RIGHT</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">draw_rectangle</span><span class="p">(</span><span class="kt">long</span> <span class="n">width</span><span class="p">,</span> <span class="kt">long</span> <span class="n">height</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">draw_top_line</span><span class="p">(</span><span class="n">width</span><span class="p">);</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">height</span> <span class="o">-</span> <span class="mi">2</span><span class="p">;</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cs1010_print_string</span><span class="p">(</span><span class="n">VERTICAL</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">width</span> <span class="o">-</span> <span class="mi">2</span><span class="p">;</span> <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">cs1010_print_string</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">cs1010_println_string</span><span class="p">(</span><span class="n">VERTICAL</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="n">draw_bottom_line</span><span class="p">(</span><span class="n">width</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>
<div class="footnote">
<hr />
<ol>
<li id="fn:1">
<p>You can also run the C pre-processor directly by invoking the command <code>cpp</code>.&#160;<a class="footnote-backref" href="#fnref:1" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
</ol>
</div>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="19-md-array.html" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                19. Multi-dimensional Arrays
              </div>
            </div>
          </a>
        
        
          <a href="21-assert.html" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                21. The assert macro
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright by Department of Computer Science, National University of Singapore 2020
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="assets/javascripts/vendor.77e55a48.min.js"></script>
      <script src="assets/javascripts/bundle.9554a270.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: ".",
          features: [],
          search: Object.assign({
            worker: "assets/javascripts/worker/search.4ac00218.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
        <script src="javascripts/config.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
      
    
  </body>
</html>